<!DOCTYPE html>
<html lang="fr" class="fontawesome-i2svg-active fontawesome-i2svg-complete">
  <head>
    <meta charset="UTF-8">
    <title>Flashcard Simple Demo</title>
    <base href="/">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css">
    <link rel="stylesheet" href="css/index.css">
  </head>
  <body>
    <script>
        // Check for the various File API support.
      if (window.File && window.FileReader && window.FileList && window.Blob) {
        // Great success! All the File APIs are supported.
      } else {
        alert('The File APIs are not fully supported in this browser.');
      }
    </script>
    <input style="display:none" type="file" id="files" name="files[]" />
    <input type="hidden" id="exceldata">
    <script>
      function base64AddPadding(str) {        
        var remainder = str.length % 4;
        var result = str;

        console.log("length=" + str.length + "remainder: " + remainder);
        switch (remainder) 
        {
          case 1 : result += "="; break;
          case 2 : result += "=="; break;
          case 3 : reuslt += "==="; break;
        }
        return result;
      }

      function _arrayBufferToBase64( buffer ) {
        var binary = '';
        var bytes = new Uint8Array( buffer );
        var len = bytes.byteLength;
        for (var i = 0; i < len; i++) {
            binary += String.fromCharCode( bytes[ i ] );
        }
        return window.btoa( binary );
      }

  function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object

    console.log("processing # files: " + files.length);

    // Loop through the FileList and render image files as thumbnails.
    for (var i = 0, f; f = files[i]; i++) {

      var reader = new FileReader();

      // Closure to capture the file information.
      reader.onload = (function(theFile) {
        return function(e) {
          var holder = document.getElementById("exceldata");
          holder.value = base64AddPadding(_arrayBufferToBase64(e.target.result));
        };
      })(f);

      // Read in the image file as a data URL.
      reader.readAsArrayBuffer(f);
    }
  }

    function readFlashCardData() {
      var holder = document.getElementById("exceldata");
      return holder.value;
    }

    var fileElement = document.getElementById('files');
    
    fileElement.addEventListener('change', handleFileSelect);

    function loadFlashCardData() {
      fileElement.click();
    }

    </script>
    <script>
      function play() {
        var audio = document.getElementById("audio");
        audio.play();
      }

      class ACard {
        init() {
          if (!('speechSynthesis' in window)) {
            alert("audio speech not available")
          } else {
            speechSynthesis.onvoiceschanged = () => {
              this._voice = this.getVoice(speechSynthesis.getVoices());
            }
          }
          this._voice = this.getVoice(speechSynthesis.getVoices());
        }

        getVoice(voices) {
          this._hasSpeechSynthesis = true;

          // In Chrome?
          let voice = speechSynthesis.getVoices().filter((voice) => voice.name === 'Google franÃ§ais')[0];
          if (voice) return voice;
          // On a Mac?
          voice = speechSynthesis.getVoices().filter((voice) => voice.name === 'Thomas')[0];
          if (voice) return voice;
          voice = speechSynthesis.getVoices().filter((voice) => voice.name === 'Amelie')[0];
          if (voice) return voice;

          this._hasSpeechSynthesis = false;
        }

        say(text) {
          if (!this._voice) {
            return;
          }
          var msg = new SpeechSynthesisUtterance();
          msg.text = text;
          msg.lang = 'fr';
          msg.voice = this._voice;
          window.speechSynthesis.speak(msg);
        }
      }

      var globalCard = new ACard();
      globalCard.init();
    </script>
    <nav class="navbar is-dark" role="navigation" aria-label="main navigation">
      <div class="navbar-brand">
        Bienvenu        
      </div>
    </nav>
    <div id="main">Loading...</div>
    <script src="_framework/blazor.webassembly.js"></script>
  </body>
</html>
